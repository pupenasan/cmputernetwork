[14. Побудова розподілених застосунків з використанням Google Scripts <--   ](14.md) [Лекції](README.md) [   --> 16.  Інтегрування з хмарними сховищами](16.md)

# 15. Google Sheet API

## Вступ

`Google Sheet` (Гугл Таблиці) - це хмарний застосунок від Google для роботи з електронними таблицями. За функціональністю і принципами роботи він схожий на `Microsoft Excel`. Усі створені таблиці зберігаються на Гугл Диску (`Google Drive`). 

Google Apps Script може використовуватися в Google Sheet для:

- додавання [спеціальних меню](https://developers.google.com/apps-script/guides/menus)
- додавання [діалогових вікон та бічних панелей](https://developers.google.com/apps- скрипт/посібники/діалоги) 
- додавання [спеціальних функцій](https://developers.google.com/apps-script/guides/sheets/functions) для Таблиць
- інтегрувати Таблиці з іншими [службами Google](https://developers .google.com/apps-script/guides/services), як-от Календар, Диск і Gmail

Більшість скриптів, розроблених для Гугл Таблиць, керують масивами для взаємодії з клітинками, рядками та стовпцями в електронній таблиці. 

Apps Script містить спеціальні API, які дозволяють програмно створювати, читати та редагувати Google Таблиці. Apps Script може взаємодіяти з Google Sheets двома способами: 

- будь-який скрипт може створювати або змінювати електронну таблицю, якщо користувач скрипту має відповідні дозволи для електронної таблиці, 
- скрипт також можна прив’язувати до електронної таблиці, що надає сценарію спеціальні можливості для зміни інтерфейсу користувача або відповіді на відкриття електронної таблиці. 

Щоб створити пов’язаний сценарій, необхідно у Google Таблиці вибрати Розширення > Apps Script.

![image-20231114161640746](media/image-20231114161640746.png)

рис.15.1. Створення розширення на Apps Script

Spreadsheet service розглядає Таблиці Google (Google Sheets) як таблицю, що працює з двовимірними масивами. Щоб отримати дані з електронної таблиці (spreadsheet), ви повинні отримати доступ до електронної таблиці, де зберігаються дані, отримати діапазон у електронній таблиці, який містить дані, а потім отримати значення клітинок. Apps Script полегшує доступ до даних, читаючи структуровані дані в електронній таблиці та створюючи для них об’єкти JavaScript

Припустімо, у вас є список назв продуктів і номерів продуктів, які ви зберігаєте в електронній таблиці, як показано на зображенні нижче.

![img](E:\san\AKIT\ДИСЦИП\Програмна інженерія\GitVersion\Довідники\googlesheet\media\spreadsheet_basics1.png)

рис.15.2. Приклад таблиці 

У прикладі нижче показано, як отримати та зареєструвати назви та номери продуктів.

```js
function logProductInfo() {
  var sheet = SpreadsheetApp.getActiveSheet();
  var data = sheet.getDataRange().getValues();
  for (var i = 0; i < data.length; i++) {
    Logger.log('Product name: ' + data[i][0]);
    Logger.log('Product number: ' + data[i][1]);
  }
}
```

Щоб переглянути зареєстровані дані, у верхній частині редактора сценаріїв натисніть **Журнал виконання**.

Щоб зберегти дані, як-от назву та номер нового продукту, до електронної таблиці, додайте наступний код у кінець скрипта.

```js
function addProduct() {
  var sheet = SpreadsheetApp.getActiveSheet();
  sheet.appendRow(['Cotton Sweatshirt XL', 'css004']);
}
```

Наведений вище код додає новий рядок унизу електронної таблиці із зазначеними значеннями. Якщо ви запустите цю функцію, ви побачите новий рядок, доданий до електронної таблиці.

## Форматування

Клас [`Range`](https://developers.google.com/apps-script/reference/spreadsheet/range) має такі методи, як [`setBackground(color)`](https://developers.google.com/ apps-script/reference/spreadsheet/range#setBackground(String)), щоб отримати доступ і змінити формат клітинки або діапазону клітинок. У наступному прикладі показано, як можна встановити стиль шрифту для діапазону:

```js
function formatMySpreadsheet() {
  // Set the font style of the cells in the range of B2:C2 to be italic.
  var ss = SpreadsheetApp.getActiveSpreadsheet();
  var sheet = ss.getSheets()[0];
  var cell = sheet.getRange('B2:C2');
  cell.setFontStyle('italic');
}
```

## Перевірка даних

Apps Script дає вам доступ до існуючих правил перевірки даних у Google Таблицях або створює нові правила. Наприклад, у наведеному нижче прикладі показано, як встановити правило перевірки даних, яке дозволяє лише числа від 1 до 100 у клітинці.

```js
function validateMySpreadsheet() {
  // Set a rule for the cell B4 to be a number between 1 and 100.
  var cell = SpreadsheetApp.getActive().getRange('B4');
  var rule = SpreadsheetApp.newDataValidation()
     .requireNumberBetween(1, 100)
     .setAllowInvalid(false)
     .setHelpText('Number must be between 1 and 100.')
     .build();
  cell.setDataValidation(rule);
}
```

Докладніше про роботу з правилами перевірки даних див [`SpreadsheetApp.newDataValidation()`](https://developers.google.com/apps-script/reference/spreadsheet/spreadsheet-app#newDataValidation()), [`DataValidationBuilder`](https://developers.google.com/apps-script/reference/spreadsheet/data-validation-builder), and [`Range.setDataValidation(rule)`](https://developers.google.com/apps-script/reference/spreadsheet/range#setDataValidation(DataValidation))

## Діаграми

Apps Script дозволяє вставляти в електронну таблицю діаграми, які представляють дані в певному діапазоні. У наведеному нижче прикладі створюється вбудована гістограма, припускаючи, що у вас є дані для діаграми в клітинках «A1:B15».

```js
function newChart() {
  // Generate a chart representing the data in the range of A1:B15.
  var ss = SpreadsheetApp.getActiveSpreadsheet();
  var sheet = ss.getSheets()[0];

  var chart = sheet.newChart()
     .setChartType(Charts.ChartType.BAR)
     .addRange(sheet.getRange('A1:B15'))
     .setPosition(5, 5, 0, 0)
     .build();

  sheet.insertChart(chart);
}
```

Щоб дізнатися більше про вбудовування діаграми в електронну таблицю, перегляньте [`EmbeddedChart`](https://developers.google.com/apps-script/reference/spreadsheet/embedded-chart) і спеціальні конструктори діаграм, як-от [`EmbeddedPieChartBuilder `](https://developers.google.com/apps-script/reference/spreadsheet/embedded-pie-chart-builder).

## Спеціальні функції в Google Таблицях 

[Спеціальна функція](https://developers.google.com/apps-script/guides/sheets/functions) подібна до вбудованої функції електронної таблиці, як-от  `=SUM(A1:A5)` , за винятком того, що ви визначаєте поведінка функцій із скриптом додатків. Наприклад, ви можете створити спеціальну функцію `in2mm()`, яка перетворює значення з дюймів на міліметри, а потім використати формулу в електронній таблиці, ввівши `=in2mm(A1)` або `=in2mm(10)`  у клітина.

Щоб дізнатися більше про користувацькі функції, спробуйте 5-хвилинний короткий посібник [Меню та користувацькі функції](https://developers.google.com/apps-script/quickstart/custom-functions) або подивіться додаткову інформацію deep [посібник із спеціальних функцій](https://developers.google.com/apps-script/guides/sheets/functions).

## Макроси

Макроси – це ще один спосіб виконання коду Apps Script з інтерфейсу Google Таблиць. На відміну від спеціальних функцій, ви активуєте їх за допомогою комбінації клавіш або через меню Google Таблиць. Щоб отримати додаткові відомості, перегляньте [Макроси Google Таблиць](https://developers.google.com/apps-script/guides/sheets/macros).

## Додатки для Google Таблиць

[Add-ons](https://developers.google.com/workspace/add-ons/overview) — це спеціально упаковані проекти сценарію додатків, які запускаються в Google Таблицях і можуть бути встановлені з магазину доповнень Google Таблиць. Якщо ви розробили сценарій для Google Таблиць і хочете поділитися ним зі світом, Apps Script дозволяє [публікувати](https://developers.google.com/workspace/add-ons/how-tos/editor-publish -огляд) ваш сценарій як доповнення, щоб інші користувачі могли встановити його з магазину доповнень.

## Тригери

Сценарії, [прив’язані](https://developers.google.com/apps-script/guides/bound) до файлу Google Таблиць, можуть використовувати [прості тригери](https://developers.google.com/apps-script /guides/triggers), як-от функції `onOpen()` і `onEdit()`, щоб автоматично реагувати, коли користувач, який має доступ до редагування електронної таблиці, відкриває або редагує електронну таблицю.

Як і прості тригери, [тригери, які можна встановити](https://developers.google.com/apps-script/guides/triggers/installable) дозволяють Google Таблицям автоматично запускати функцію, коли відбувається певна подія. Однак тригери, які можна встановити, пропонують більшу гнучкість, ніж прості тригери, і підтримують такі події: відкриття, редагування, зміна, надсилання форми та керування часом (годинник).

https://developers.google.com/sheets/api/guides/concepts





## Запитання для самоперевірки

1. Щ







https://blog.coupler.io/google-apps-script-tutorial/#What_makes_Google_Apps_Script_useful

